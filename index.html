<html>
	<head>
		<script type="text/javascript" src="Collision.js"></script>
		<script type="text/javascript" src="Math.js"></script>
		<script type="text/javascript" src="Enum.js"></script>
		<script type="text/javascript" src="Graphics.js"></script>
		<script type="text/javascript" src="Inheritance.js"></script>
		<script type="text/javascript" src="WorldObject.js"></script>
		<script type="text/javascript" src="EventDelegate.js"></script>
		<script type="text/javascript" src="World.js"></script>
		<script type="text/javascript" src="Game.js"></script>
		<script type="text/javascript" src="Debug.js"></script>
	</head>
	<body>
		<canvas id="GameScreen" width="800" height="600">Canvas not supported.</canvas>
		<script type="text/javascript">
			BallController = WorldObject.Extend(
				{
					Draw : function() {},
					Events :
					{
						click : function(Me, Evt)
						{
							console.log("YEAH");
							var SpawnBall = Ball.New();
							SpawnBall.x = Math.random() * Graphics.Width;
							SpawnBall.y = Math.random() * Graphics.Height;
							World.Add(SpawnBall);
						}
					}
				}
			);
		
			Ball = WorldObject.Extend(
				{
					x : 100,
					y : 100,
					Scale : .5,
					Class : "Ball",
					Update : function(Me, dt)
					{
					
						// Manual wall bounce collisions
						if (typeof Me.Data.Sprite !== 'undefined')
						{
							if (Me.y + Me.Data.Sprite.height / 2 * Me.Scale > Graphics.Height || Me.y - Me.Data.Sprite.height / 2 * Me.Scale < 0)
							{
								Me.Data.vy *= -1;
							}
							if (Me.x + Me.Data.Sprite.width / 2 * Me.Scale > Graphics.Width || Me.x - Me.Data.Sprite.width / 2 * Me.Scale < 0)
							{
								Me.Data.vx *= -1;
							}
						}
						
						Me.x += Me.Data.vx * dt;
						Me.y += Me.Data.vy * dt;
					},
					Data :
					{
						vx : 800,
						vy : 800
					},
					Collision : Collision.Circle(60),
					Events :
					{
						oncollision : function(Me, Him)
						{
							var angleTo = Me.AngleTo(Him);
							Me.Data.vx = 800 * Math.cos( angleTo );
							Me.Data.vy = 800 * Math.sin( angleTo );
						}
					}
				}
			);
			
			OtherBall = Ball.Extend(
				{
					x : 300,
					y : 300,
					Class : "OtherBall",
					Events :
					{
						mousedown : function(Me, Evt)
						{
							Me.Data.MouseDown = true;
						},
						mouseup : function(Me, Evt)
						{
							Me.Data.MouseDown = false;
						},
						mousemove : function(Me, Evt)
						{
							Me.Data.MouseX = Evt.x;
							Me.Data.MouseY = Evt.y;
						}
					},
					Update : function(Me, dt)
					{
						if (Me.Data.MouseDown)
						{
							var mouseSlope = Math.slope(Me.x, Me.y, Me.Data.MouseX, Me.Data.MouseY);
							Me.x += 10 * mouseSlope.x * dt;
							Me.y += 10 * mouseSlope.y * dt;
						}
					},
					Data :
					{
						MouseDown : false,
						deltaX : 1,
						deltaY : 1
					}
				}
			);
			
			var MyBall = Ball.New();
			
			World.Add(MyBall, BallController.New());
			
			Game.Start("GameScreen");
		</script>
	</body>
</html>